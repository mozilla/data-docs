The Addons dataset
==================

The Addons dataset is generated by `src/main/scala/com/mozilla/telemetry/views/AddonsView.scala`. It contains one or more records for every [Main Summary](MainSummary.md) record that contains a non-null value for client_id. Each Addons record contains info for a single addon, or if the main ping did not contain any active addons, there will be a row with nulls for all the addon fields (to identify client_ids/records without any addons).

Like the Main Summary dataset, No attempt is made to de-duplicate submissions by `documentId`, so any analysis that could be affected by duplicate records should take care to remove duplicates using the `documentId` field.

Generating the dataset
======================

The dataset is generated in the same way that the [Main Summary](MainSummary.md) is generated, with one exception. You can specify a different bucket name to use for reading the Main Summary data with the `inbucket` argument. Without this argument, it uses the same bucket for input and output. For example:

```bash
spark-submit \
    --master yarn \
    --deploy-mode client \
    --class com.mozilla.telemetry.views.AddonsView \
    telemetry-batch-view-1.1.jar \
    --bucket example_bucket \
    --inbucket another_bucket \
    --from 20160412 \
    --to 20160428
```

Notes:

* This dataset is updated daily via the [telemetry-airflow](https://github.com/mozilla/telemetry-airflow) infrastructure.
* The job DAG runs every day after the Main Summary data has been generated.
* The job saves the resulting data to S3 as [Parquet](https://parquet.apache.org/)-serialized [DataFrames](https://spark.apache.org/docs/latest/api/java/org/apache/spark/sql/DataFrame.html), under prefixes of the form `addons/vX/submission_date_s3=(YYYYMMDD SUBMISSION DATE)/sample_id=(INT VALUE)` in the `telemetry-parquet` bucket.
* Each of these prefixes is a partition. There is a partition for each `submissionDate` + `sampleId`.
* The Addons data can be accessed from Spark via clusters launched at [analysis.telemetry.mozilla.org](https://analysis.telemetry.mozilla.org/).

Schemas and Making Queries
--------------------------

As of 2017-03-16, the current version of the `addons` dataset is `v2`, and has a schema as follows:
```
root
 |-- document_id: string (nullable = true)
 |-- client_id: string (nullable = true)
 |-- subsession_start_date: string (nullable = true)
 |-- normalized_channel: string (nullable = true)
 |-- addon_id: string (nullable = true)
 |-- blocklisted: boolean (nullable = true)
 |-- name: string (nullable = true)
 |-- user_disabled: boolean (nullable = true)
 |-- app_disabled: boolean (nullable = true)
 |-- version: string (nullable = true)
 |-- scope: integer (nullable = true)
 |-- type: string (nullable = true)
 |-- foreign_install: boolean (nullable = true)
 |-- has_binary_components: boolean (nullable = true)
 |-- install_day: integer (nullable = true)
 |-- update_day: integer (nullable = true)
 |-- signed_state: integer (nullable = true)
 |-- is_system: boolean (nullable = true)
 |-- submission_date_s3: string (nullable = true)
 |-- sample_id: string (nullable = true)
```
For more detail on where these fields come from in the
[raw data](https://gecko.readthedocs.io/en/latest/toolkit/components/telemetry/telemetry/data/environment.html#addons),
please look [in the AddonsView code](src/main/scala/views/AddonsView.scala).

The fields are all simple scalar values.
