The Longitudinal Derived Stream
-------------------------------

The longitudinal dataset is generated by `src/main/scala/com/mozilla/telemetry/views/Longitudinal.scala`. It's useful for running fast queries on common fields in pings, such as user OSs, channels, and settings.

The resulting dataset can be retrieved as a [DataFrame](https://spark.apache.org/docs/1.6.0/api/java/org/apache/spark/sql/DataFrame.html), which can be thought of as a distributed array of map of arrays:

* The outer array (which is actually a DataFrame) contains one element per client (clients are distinguished by the `clientId` top-level field in pings).
* Each element of that outer array is a map, where fields are the ones defined in `src/main/scala/streams/Longitudinal.scala` in the `buildSchema` function. Remember that the map represents a single client.
  * Whenever records are converted from JSON, JSON keys are converted from camelCase (in the original ping) into snake_case (in the resulting dataset) by `src/main/scala/com/mozilla/telemetry/avro/JSON2Avro.scala`.
  * For example, the `firstPaint` simple measure in a ping object like `(payload.simpleMeasurements -> {"firstPaint":2114,...other simple measurements...},...other fields..)` shows up under `first_paint` in the resulting dataset.
  * The `buildRecord` function in `src/main/scala/com/mozilla/telemetry/views/Longitudinal.scala` defines exactly how fields in the pings map to fields in the schema.
* Most values in the map are themselves arrays, where elements are the values of that field in the payloads sent by that client.
  * For example, the `geo_country` field will be an array of string country codes, representing the `geoCountry` top-level field in each of the pings sent by that client.
  * Certain fields, like `client_id` (representing `clientId` in the original pings) are not arrays, because they are always the same for a given client.
* The dots `.` in the [scalar](https://gecko.readthedocs.io/en/latest/toolkit/components/telemetry/telemetry/collection/scalars.html) probe names are replaced with underscores `_`. Moreover, to prevent name collisions between scalars and histograms, scalars are prefixed with `scalar_`. The name of the process generating the data immediately follows the prefix. For example, the `test.group.probe_name` scalar probe, set from the `parent` process, can be looked up as `scalar_parent_test_group_probe_name`.

Note that the pings seen by the code are not exactly the raw pings you see in the [Gecko docs](https://gecko.readthedocs.io/en/latest/toolkit/components/telemetry/telemetry/data/main-ping.html). Instead, they're the output of the [data pipeline](https://github.com/mozilla-services/data-pipeline). An example of one of these pings can be found [here](https://gist.github.com/Uberi/686fb2b475ed5924c40b).
