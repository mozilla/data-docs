# Heavy Users

***As of 2018-05-18, this dataset has been deprecated and is no longer maintained. See [Bug 1455314](https://bugzilla.mozilla.org/show_bug.cgi?id=1455314)***

<!-- toc -->

# Replacement

We've moved to assigning user's an active tag based on `total_uri_count`, see
the [Active DAU definition](../../../cookbooks/active_dau.md).

The activity of a user based on `active_ticks` is available in `clients_daily`
in the `active_hours_sum` field, which has the `sum(active_ticks / 720)`.

To retrieve a client's 28-day `active_hours`, use the following query:
```sql
SELECT submission_date_s3,
       client_id,
       SUM(active_hours_sum) OVER (PARTITION BY client_id
                                   ORDER BY submission_date_s3 ASC
                                   ROWS 27 PRECEDING) AS monthly_active_hours
FROM
    clients_daily
```

# Introduction

{{#include ./intro.md}}

# Data Reference

## Example Queries

Example queries:

- [Join `heavy_users` with `main_summary` to get distribution of `max_concurrent_tab_count` for heavy vs. non-heavy users](https://sql.telemetry.mozilla.org/queries/47041/source#127382)
- [Join `heavy_users` with `longitudinal` to get crash rates for heavy vs. non-heavy users](https://sql.telemetry.mozilla.org/queries/47044/source#127385)

## Scheduling

This dataset is updated daily via the [telemetry-airflow](https://github.com/mozilla/telemetry-airflow) infrastructure.
The job DAG runs every day after `main_summary` is complete.
You can find the job definition
[here](https://github.com/mozilla/telemetry-airflow/blob/master/dags/main_summary.py#L187-L195).

## Schema

As of 2017-10-05, the current version of the `heavy_users` dataset is `v1`, and has a schema as follows:

```
root
 |-- client_id: string (nullable = true)
 |-- sample_id: integer (nullable = true)
 |-- profile_creation_date: long (nullable = true)
 |-- active_ticks: long (nullable = true)
 |-- active_ticks_period: long (nullable = true)
 |-- heavy_user: boolean (nullable = true)
 |-- prev_year_heavy_user: boolean (nullable = true)
 |-- submission_date_s3: string (nullable = true)
```

# Code Reference

This dataset is generated by
[telemetry-batch-view](https://github.com/mozilla/telemetry-batch-view/blob/master/GRAVEYARD.md#heavy-users).
Refer to this repository for information on how to run or augment the dataset.
